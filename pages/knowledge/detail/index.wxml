<!-- pages/knowledge/detail/index.wxml -->

<!-- 加载状态 -->
<view class="loading-container" wx:if="{{loading}}">
  <image class="loading-icon" src="/static/icons/loading.gif" mode="aspectFit"></image>
  <text class="loading-text">加载中...</text>
</view>

<!-- 错误状态 -->
<view class="error-container" wx:elif="{{error}}">
  <image class="error-icon" src="/static/icons/error.png" mode="aspectFit"></image>
  <text class="error-text">{{error}}</text>
  <button class="retry-btn" bindtap="loadArticleDetail">重新加载</button>
</view>

<!-- 文章详情 -->
<view class="article-container" wx:else>
  <!-- 文章标题 -->
  <view class="article-header">
    <text class="article-title">{{article.title}}</text>
    
    <!-- 文章元信息 -->
    <view class="article-meta">
      <text class="author">{{article.author || '农业专家'}}</text>
      <text class="dot">·</text>
      <text class="date">{{article.createdAt || '2024-01-01'}}</text>
      <text class="dot">·</text>
      <view class="category-tag" bindtap="goToCategory">
        {{article.categoryName || '未分类'}}
      </view>
    </view>
  </view>

  <!-- 文章封面图 -->
  <image class="article-cover" wx:if="{{article.coverImage}}" src="{{article.coverImage}}" mode="aspectFill"></image>

  <!-- 文章内容 -->
  <view class="article-content">
    <rich-text nodes="{{article.content}}"></rich-text>
  </view>

  <!-- 文章统计信息 -->
  <view class="article-stats">
    <view class="stat-item">
      <image class="stat-icon" src="/static/icons/eye.png" mode="aspectFit"></image>
      <text class="stat-text">{{article.viewCount || 0}} 浏览</text>
    </view>
    <view class="stat-item">
      <image class="stat-icon" src="/static/icons/like.png" mode="aspectFit"></image>
      <text class="stat-text">{{article.likeCount || 0}} 点赞</text>
    </view>
  </view>

  <!-- 操作栏 -->
  <view class="action-bar">
    <button class="action-btn favorite-btn {{article.isFavorite ? 'favorited' : ''}}" bindtap="toggleFavorite">
      <image class="action-icon" src="{{article.isFavorite ? '/static/icons/favorite-active.png' : '/static/icons/favorite.png'}}" mode="aspectFit"></image>
      <text class="action-text">{{article.isFavorite ? '已收藏' : '收藏'}}</text>
    </button>
    <button open-type="share" class="action-btn share-btn">
      <image class="action-icon" src="/static/icons/share.png" mode="aspectFit"></image>
      <text class="action-text">分享</text>
    </button>
  </view>

  <!-- 相关推荐 -->
  <view class="recommended-section" wx:if="{{article.relatedArticles && article.relatedArticles.length > 0}}">
    <view class="section-title">相关推荐</view>
    <view class="recommended-list">
      <view class="recommended-item" wx:for="{{article.relatedArticles}}" wx:key="id" bindtap="navigateToDetail" data-id="{{item.id}}">
        <view class="recommended-info">
          <text class="recommended-title">{{item.title}}</text>
          <text class="recommended-meta">{{item.categoryName}} · {{item.createdAt}}</text>
        </view>
        <image class="recommended-cover" wx:if="{{item.coverImage}}" src="{{item.coverImage}}" mode="aspectFill"></image>
      </view>
    </view>
  </view>
</view>