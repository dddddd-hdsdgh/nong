<!-- pages/knowledge/category/index.wxml -->

<!-- 加载状态 -->
<view class="loading-container" wx:if="{{loading && articles.length === 0}}">
  <image class="loading-icon" src="/static/icons/loading.gif" mode="aspectFit"></image>
  <text class="loading-text">加载中...</text>
</view>

<!-- 错误状态 -->
<view class="error-container" wx:elif="{{error}}">
  <image class="error-icon" src="/static/icons/error.png" mode="aspectFit"></image>
  <text class="error-text">{{error}}</text>
  <button class="retry-btn" bindtap="loadArticles" data-refresh="true">重新加载</button>
</view>

<!-- 文章列表 -->
<view class="article-list" wx:else>
  <!-- 空状态 -->
  <view class="empty-container" wx:if="{{articles.length === 0 && !loading}}">
    <image class="empty-icon" src="/static/icons/empty.png" mode="aspectFit"></image>
    <text class="empty-text">该分类下暂无文章</text>
  </view>
  
  <!-- 文章列表 -->
  <view wx:for="{{articles}}" wx:key="id" class="article-item">
    <view class="article-content" bindtap="navigateToDetail" data-id="{{item.id}}">
      <!-- 文章标题和摘要 -->
      <view class="article-info">
        <text class="article-title">{{item.title}}</text>
        <text class="article-summary">{{item.summary || item.content.replace(/<[^>]*>/g, '').substring(0, 100)}}...</text>
        
        <!-- 文章元信息 -->
        <view class="article-meta">
          <text class="author">{{item.author || '农业专家'}}</text>
          <text class="dot">·</text>
          <text class="date">{{item.createdAt || '2024-01-01'}}</text>
          <text class="dot">·</text>
          <text class="view-count">{{item.viewCount || 0}} 浏览</text>
        </view>
      </view>
      
      <!-- 文章封面图 -->
      <image class="article-cover" wx:if="{{item.coverImage}}" src="{{item.coverImage}}" mode="aspectFill"></image>
    </view>
    
    <!-- 操作栏 -->
    <view class="article-action">
      <view class="action-item" bindtap="toggleFavorite" data-id="{{item.id}}">
        <image class="action-icon" src="{{item.isFavorite ? '/static/icons/favorite-active.png' : '/static/icons/favorite.png'}}" mode="aspectFit"></image>
        <text class="action-text">{{item.likeCount || 0}}</text>
      </view>
    </view>
  </view>
  
  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{loading && articles.length > 0}}">
    <image class="loading-small-icon" src="/static/icons/loading.gif" mode="aspectFit"></image>
    <text class="load-more-text">加载更多...</text>
  </view>
  
  <!-- 没有更多 -->
  <view class="no-more" wx:if="{{!loading && !hasMore && articles.length > 0}}">
    <text class="no-more-text">没有更多内容了</text>
  </view>
</view>